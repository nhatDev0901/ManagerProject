@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Manager/Views/Shared/_LayoutHome.cshtml";
}

<div class="col-lg-6 grid-margin stretch-card" style="float: left">
    <div class="card">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center pb-4">
                <h4 class="card-title mb-0">Sales Performance</h4>
                <div id="line-traffic-legend"></div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    <h2 class="mb-0 font-weight-medium">$5,341</h2>
                    <p class="mb-5 text-muted">Sales</p>
                </div>
                <div class="col-md-3">
                    <h2 class="mb-0 font-weight-medium">$1,334</h2>
                    <p class="mb-5 text-muted">Profits</p>
                </div>
            </div>
            <div class="k-content">
                <div id="chart"></div>
            </div>
        </div>
    </div>
</div>

<div class="col-lg-6 grid-margin stretch-card">
    <div class="card">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center pb-4">
                <h4 class="card-title mb-0">The ratio between public and non-public submissions in your Department</h4>
                <div id="line-traffic-legend"></div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    <h2 class="mb-0 font-weight-medium">@Html.Raw(ViewBag.totalPublic)</h2>
                    <p class="mb-5 text-muted">Total public</p>
                </div>
                <div class="col-md-3">
                    <h2 class="mb-0 font-weight-medium">@Html.Raw(ViewBag.totalNonPublic)</h2>
                    <p class="mb-5 text-muted">Total non-public</p>
                </div>
            </div>
            <div class="k-content">
                <div id="pie-chart"></div>
            </div>
        </div>
    </div>
</div>

<div class="col-md-12 grid-margin" style="float: left">
    <div class="card">
        <div class="p-4 border-bottom bg-light">
            <h4 class="card-title mb-0">Statistics of the number of submissions of students in the Faculty.</h4>
        </div>
        <div class="card-body">
            <div class="k-content">
                <div id="chart2"></div>
            </div>
            <div class="mr-5" id="mixed-chart-legend"></div>
        </div>
    </div>
</div>

<script>
    var dataPichart = [];
    $("#chart").kendoChart({
        title: {
            text: "TIEU DE THONG KE"
        },
        legend: {
            position: "bottom"
        },
        chartArea: {
            background: ""
        },
        seriesDefaults: {
            type: "line",
            style: "smooth"
        },
        series: [{
            name: "India",
            data: [3.907, 7.943, 7.848, 9.284, 9.263, 9.801, 3.890, 8.238, 9.552, 6.855]
        }, {
            name: "World",
            data: [1.988, 2.733, 3.994, 3.464, 4.001, 3.939, 1.333, -2.245, 4.339, 2.727]
        }, {
            name: "Russian Federation",
            data: [4.743, 7.295, 7.175, 6.376, 8.153, 8.535, 5.247, -7.832, 4.3, 4.3]
        }, {
            name: "Haiti",
            data: [-0.253, 0.362, -3.519, 1.799, 2.252, 3.343, 0.843, 2.877, -5.416, 5.590]
        }],
        valueAxis: {
            labels: {
                format: "{0}%"
            },
            line: {
                visible: false
            },
            axisCrossingValue: -10
        },
        categoryAxis: {
            categories: [2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011],
            majorGridLines: {
                visible: false
            },
            labels: {
                rotation: "auto"
            }
        },
        tooltip: {
            visible: true,
            format: "{0}%",
            template: "#= series.name #: #= value #"
        }
    });

    $("#pie-chart").kendoChart({
        dataSource: {
            data: dataPichart
        },
        title: {
            position: "bottom",
            text: ""
        },
        legend: {
            visible: false
        },
        chartArea: {
            background: ""
        },
        seriesDefaults: {
            labels: {
                visible: true,
                background: "transparent",
                template: "#= category #: \n #= value#%"
            }
        },
        series: [{
            type: "pie",
            startAngle: 150,
            field: "value",
            color: "color",

        }],
        tooltip: {
            visible: true,
            format: "{0}%"
        }
    });

    $("#chart2").kendoChart({
        series: [{
            field: 'value',
            type: "bar",
            categoryField: "name",
            width: 1,
            overlay: {
                gradient: "none"
            },
            border: {
                width: 0,
            },
        }],
        legend: { visible: false },
        seriesDefaults: {
            color: "#2BBBE7",
            labels: {
                visible: true,
                font: "14px Quicksand",
                color: "rgba(0, 0, 0, 0.52)",
            },
        },
        valueAxis: {
            labels: { visible: false, },
            line: false
        },
        dataBound: function () {

            if (this.dataSource.data().length <= 10) {
                $(".loadmore-hidden-fieldCollector").addClass("d-none");
            }
            else {
                $(".loadmore-hidden-fieldCollector").removeClass("d-none");
            }
            if (this.dataSource.data().length == 0) {
                $(".text-nocomment-chart2").remove();
                $("#chart2").after('<div class=" text-nocomment-chart2 mt-1 mb-1"><span>NO DATA</span></div> ');
            }
            else {
                $(".text-nocomment-chart2").remove();
            }
        },
        categoryAxis: [{
            labels: {
                font: "14px Quicksand ",
                template: "#= value #",
            },
        }],
    }).data("kendoChart");

    function GetRatePublicByDepartment() {
        $.ajax({
            url: '@Url.Action("GetRateOfSubmissionOrNotSubmissionStatistic", "ManagerHome")',
            type: "POST",
            dataType: "json",
            success: function (result) {
                var chart = $("#pie-chart").data("kendoChart");
                var dataSource = new kendo.data.DataSource({
                    data: result
                });
                chart.setDataSource(dataSource);

            }
        });
    }
    function GetNumberOfSubmissionsInDepartment() {
        var dataCollector = new kendo.data.DataSource({
            transport: {
                read: {
                    url: '@Url.Action("GetNumberOfSubmissionsAll", "ManagerHome")',
                    dataType: "json"
                }
            },
            schema: {
                data: "Data",
                total: "Total"
            },
            serverPaging: true,
            pageSize: 10
        });

        dataCollector.fetch(function () {
            $("#chart2").data("kendoChart").setDataSource(dataCollector.data());
            $("#chart2").data("kendoChart").dataSource.pageSize(10);
        });
    }
    GetRatePublicByDepartment();
    GetNumberOfSubmissionsInDepartment();

</script>

